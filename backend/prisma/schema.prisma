generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PaymentMethod {
  PIX
  DINHEIRO
  CARTAO
}

enum Role {
  ADMIN
  COZINHA
  DELIVERY
}

// --- NOVO MODELO ---
model Organization {
  id        Int      @id @default(autoincrement())
  name      String   @default("Minha Confeitaria")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users         User[]
  clients       Client[]
  products      Product[]
  orders        Order[]
  expenses      Expense[]
  notices       Notice[]
  monthlyReports MonthlyReport[]
}

model Client {
  id             Int          @id @default(autoincrement())
  name           String
  phone          String?
  address        String?
  birthday       DateTime?
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  deletedAt      DateTime?

  // Relação com Organização
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])

  orders         Order[]
}

model User {
  id             Int          @id @default(autoincrement())
  email          String       @unique
  name           String?
  password       String
  role           Role         @default(COZINHA)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  // deletedAt   DateTime? // Se quiser soft delete no user

  // Relação com Organização
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])

  orders         Order[]
  auditLogs      AuditLog[]
  expenses       Expense[]
  notices        Notice[]
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  entity    String
  entityId  Int
  details   String?
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  // AuditLog geralmente não precisa de organizationId direto se já tem User, 
  // mas se o seu código pedir, adicione aqui também.
}

model Product {
  id             Int          @id @default(autoincrement())
  name           String
  price          Decimal      @db.Decimal(10, 2)
  description    String?
  stockKitchen   Int          @default(0)
  stockDelivery  Int          @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  deletedAt      DateTime?

  // Relação com Organização
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])

  orderItems     OrderItem[]
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  quantity  Int
  price     Decimal
  
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   Int
  
  product   Product @relation(fields: [productId], references: [id])
  productId Int

  @@unique([orderId, productId])
}

model Order {
  id            Int            @id @default(autoincrement())
  createdAt     DateTime       @default(now())
  status        String         @default("PENDENTE")
  total         Decimal        @db.Decimal(10, 2)
  observations  String?
  deliveryDate  DateTime?
  paymentMethod PaymentMethod? @default(PIX)
  deletedAt     DateTime?

  user          User           @relation(fields: [userId], references: [id])
  userId        Int

  client        Client?        @relation(fields: [clientId], references: [id])
  clientId      Int?

  // Relação com Organização
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])

  items         OrderItem[]
}

model Expense {
  id             Int          @id @default(autoincrement())
  description    String
  amount         Decimal      @db.Decimal(10, 2)
  date           DateTime     @default(now())
  category       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  deletedAt      DateTime?

  user           User         @relation(fields: [userId], references: [id])
  userId         Int

  // Relação com Organização
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])
}

model MonthlyReport {
  id            Int      @id @default(autoincrement())
  month         Int
  year          Int
  totalRevenue  Decimal
  totalExpenses Decimal
  netProfit     Decimal
  pdfData       Bytes
  createdAt     DateTime @default(now())

  // Relação com Organização (Seu código pede isso)
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])
}

model Notice {
  id             Int          @id @default(autoincrement())
  title          String
  content        String
  createdAt      DateTime     @default(now())

  user           User         @relation(fields: [userId], references: [id])
  userId         Int

  // Relação com Organização
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])
}
